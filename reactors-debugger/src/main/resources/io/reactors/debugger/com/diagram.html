@@style(io/reactors/debugger/lib/bootstrap/css/bootstrap.min.css)
@@library(io/reactors/debugger/js/util.js)
@@library(io/reactors/debugger/lib/jquery/jquery-1.12.4.min.js)
@@library(io/reactors/debugger/lib/bootstrap/js/bootstrap.min.js)
@@library(io/reactors/debugger/lib/sigmajs/sigma.min.js)


<template id="x-diagram">
  <div :class="'x-diagram-root ' + canvasClass">
    <div :id="'x-diagram-sigma-' + uid" class="x-diagram-sigma">
    </div>
  </div>
</template>


<script>
  var Diagram = Vue.extend({
    template: "#x-diagram",
    props: ["config", "model", "eventBus", "canvasClass"],
    data: function() {
      return {
        uid: Uid.num(),
        sigma: null,
        subscriptions: []
      };
    },
    attached: function() {
      this.sigma = new sigma({
        container: "x-diagram-sigma-" + this.uid
      });

      this.subscriptions.push(this.eventBus.observe("state-reset-start", () => {
        this.resetState();
      }));

      this.subscriptions.push(this.eventBus.observe("reactor-seen", (uid) => {
        this.addReactor(uid);
      }));

      this.subscriptions.push(this.eventBus.observe("reactor-started", (uid) => {
        this.addReactor(uid);
      }));

      this.subscriptions.push(this.eventBus.observe("state-reset-done", () => {
        this.endResetState();
      }));
    },
    methods: {
      resetState: function() {
        this.sigma.graph.clear();
      },
      addReactor: function(uid) {
        this.sigma.graph.addNode({
          id: uid,
          label: this.model.reactors[uid].name,
          x: 0,
          y: 0,
          size: 1,
          color: "#f00"
        });
      },
      endResetState: function() {
        this.sigma.refresh();
      }
    },
    destroyed: function() {
      for (var i = 0; i < this.subscriptions.length; i++) {
        this.subscriptions[i]();
      }
    }
  });

  Vue.component("x-diagram", Diagram);
</script>


<style type="text/css">
  .x-diagram-root {
    height: 100%;
    background: #000;
  }

  .x-diagram-sigma {
    height: 100%;
    background: url(img/nebula.png);
    opacity: 0.6;
  }
</style>
