@@style(io/reactors/debugger/css/vars.css)
@@style(io/reactors/debugger/lib/bootstrap/css/bootstrap.min.css)
@@style(io/reactors/debugger/lib/datatables/datatables.min.css)
@@style(io/reactors/debugger/css/bootstrap-overrides.css)
@@style(io/reactors/debugger/css/datatables-overrides.css)
@@style(io/reactors/debugger/css/vue-tables-overrides.css)
@@library(io/reactors/debugger/js/util.js)
@@library(io/reactors/debugger/lib/jquery/jquery-1.12.4.min.js)
@@library(io/reactors/debugger/lib/bootstrap/js/bootstrap.min.js)
@@library(io/reactors/debugger/lib/vue-tables/vue-tables.min.js)


<template id="x-log-window">
  <div class="x-log-window-root">
    <div class="x-log-window-table-container">
      <v-client-table :data="tableData" :columns="tableColumns" :options="tableOptions"
        class="x-log-window-table cell-border">
      </v-client-table>
    </div>
  </div>
</template>


<script>
  Vue.use(VueTables.client, {});

  var LogWindow = Vue.extend({
    template: "#x-log-window",
    props: ["config", "history"],
    data: function() {
      return {
        uid: Uid.num(),
        tableColumns: ["Event", "Time", "Message"],
        tableOptions: {
          orderBy: {
            ascending: false,
            column: "Time"
          }
        }
      };
    },
    computed: {
      tableData: function() {
        var data = [];
        for (var i = 0; i < this.history.length; i++) {
          var delta = this.history[i];
          var link = this.linkFor(delta);
          var time = this.timeFor(delta);
          var msg = this.messageFor(delta);
          data.push({
            "Event": link,
            "Time": time,
            "Message": msg
          });
        }
        return data;
      }
    },
    attached: function() {
    },
    methods: {
      timeFor: function(delta) {
        var unixts = delta.time;
        return new Date(unixts);
      },
      linkFor: function(delta) {
        switch (delta.tpe) {
          case "start":
            return "<span class='x-log-window-event-created'>" +
              "<i class='icon ion-nuclear'></i> STARTED" +
              "</span>";
          case "term":
            return "<span class='x-log-window-event-terminated'>" +
              "<i class='icon ion-nuclear'></i> TERMINATED" +
              "</span>";
          default:
            return "";
        }
      },
      messageFor: function(delta) {
        switch (delta.tpe) {
          case "start":
            return "Reactor '" + delta.reactorName +
              "' (UID: " + delta.reactorId + ") created.";
          case "die":
            return "Reactor " + delta.reactorName +
              "' (UID: " + delta.reactorId + ") died due to an error.";
          case "term":
            return "Reactor " + delta.reactorName +
              "' (UID: " + delta.reactorId + ") terminated.";
          case "open":
            return "Channel '" + delta.channelName +
              "' (UID: " + delta.channelId + ") opened.";
          case "seal":
            return "Channel '" + delta.channelName +
              "' (UID: " + delta.channelId + ") sealed.";
          default:
            return "Unknown event " + delta.tpe + ".";
        }
      },
      onSelected: function() {
      }
    }
  });

  Vue.component("x-log-window", LogWindow);
</script>


<style type="text/css">
  .x-log-window-root {
    width: 100%;
  }

  .x-log-window-table {
    width: 100%;
    background-color: var(--widget-background-color);
    border: var(--widget-border);
    padding: 4px;
    height: 360px;
  }

  .x-log-window-event-created {
    color: var(--log-event-created);
  }

  .x-log-window-event-terminated {
    color: var(--log-event-terminated);
  }
</style>
